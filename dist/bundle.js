(()=>{"use strict";function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,n(i.key),i)}}function r(e,t,r){return(t=n(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function n(t){var r=function(t,r){if("object"!=e(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var i=n.call(t,"string");if("object"!=e(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==e(r)?r:String(r)}var i=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),r(this,"shouldBeDestroyed",!1),r(this,"eatCellFn",void 0),this.cellSize=t,this.getGridPosInPx=n,this.snakePosList=[]}var n,i;return n=e,(i=[{key:"init",value:function(e,t,r){this.snakePosList=t,this.eatCellFn=e,this.dir=r}},{key:"headPos",value:function(){return this.snakePosList.at(0)}},{key:"tailPos",value:function(){return this.snakePosList.at(-1)}},{key:"snakeLength",value:function(){return this.snakePosList.length}},{key:"drawCell",value:function(e,t){e.fillStyle="lightgreen",e.fillRect(t[0],t[1],this.cellSize,this.cellSize)}},{key:"drawEye",value:function(e,t){e.fillStyle="yellow",e.strokeStyle="black",e.lineWidth=1,e.beginPath(),e.ellipse(t[0],t[1],6,3,0,0,2*Math.PI),e.fill(),e.stroke(),e.fillStyle="red",e.fillRect(t[0]-2,t[1]-3,3,6)}},{key:"_getRotDeg",value:function(){switch(!0){case-1===this.dir[1]:return 180;case 1===this.dir[0]:return-90;case 1===this.dir[1]:return 0;case-1===this.dir[0]:return 90}}},{key:"drawHead",value:function(e,t){this.drawCell(e,t),this.drawEye(e,[t[0]+.3*this.cellSize,t[1]+.5*this.cellSize]),this.drawEye(e,[t[0]+.7*this.cellSize,t[1]+.5*this.cellSize])}},{key:"destroy",value:function(){this.shouldBeDestroyed=!0}},{key:"update",value:function(e){if(0==e||30==e){var t=this.headPos(),r=[t[0]+this.dir[0],t[1]+this.dir[1]],n=this.eatCellFn(r,this.tailPos());this.snakePosList.unshift(r),n||this.snakePosList.pop()}}},{key:"draw",value:function(e){var t=this;this.snakePosList.slice(0,1).forEach((function(r){return t.drawHead(e,t.getGridPosInPx(r))})),this.snakePosList.slice(1).forEach((function(r){return t.drawCell(e,t.getGridPosInPx(r))}))}}])&&t(n.prototype,i),Object.defineProperty(n,"prototype",{writable:!1}),e}();const o=i;function s(e){return s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s(e)}function a(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,u(n.key),n)}}function l(e,t,r){return(t=u(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function u(e){var t=function(e,t){if("object"!=s(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!=s(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==s(t)?t:String(t)}var c=new Image;c.src="data:img/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAKCAMAAAC38k/IAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAOVBMVEX///8JJgDsLwDrLgDrLwDrLgDsLwBn/wBo/wAAAADsLwDnLgDoLgDrLwDrLgDnLQDpLgDlLQD///+X4fLXAAAAB3RSTlMAAQIBAQIBGLc12wAAAAFiS0dEAIgFHUgAAAAHdElNRQfoAwkSKw/1BpHzAAAATUlEQVQI10WLCw6AMAhDcf6gWjbvf1m7LdFHgJJSs8lpH4v7f4R7GWIFrnAAm1nRwt0H5BAJShK7HQRTrVIMSGY3WMYfapsRgRbxUOIFmDIDBS3ftboAAAAASUVORK5CYII=";var f=function(){function e(t,r,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"lightyellow";!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),l(this,"shouldBeDestroyed",!1),l(this,"color",void 0),l(this,"centerPos",void 0),l(this,"gridPos",void 0),this.gridPos=t,this.color=i,this.centerPos=[r[0]+.5*n,r[1]+.5*n]}var t,r;return t=e,(r=[{key:"destroy",value:function(){this.shouldBeDestroyed=!0}},{key:"update",value:function(){}},{key:"draw",value:function(e){e.drawImage(c,this.centerPos[0]-.5*c.width,this.centerPos[1]-.5*c.height,c.width,c.height)}}])&&a(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();const h=f;function d(e){return d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},d(e)}function y(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,v(n.key),n)}}function v(e){var t=function(e,t){if("object"!=d(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!=d(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==d(t)?t:String(t)}var p=function(){function e(t,r,n,i){var o,s;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),o=this,(s=v(s="shouldBeDestroyed"))in o?Object.defineProperty(o,s,{value:false,enumerable:!0,configurable:!0,writable:!0}):o[s]=false,this.text=i,this.draw=function(e){e.globalAlpha=.2,e.fillStyle="000",e.fillRect(0,0,t,r),e.globalAlpha=1,e.font="48px serif",e.fillStyle="white",e.textAlign="center";var o=i.split("\n"),s=.5*r-n*o.length*.5,a=2*n;o.forEach((function(r,n){e.fillText(r,.5*t,s+n*a)}))}}var t,r;return t=e,(r=[{key:"update",value:function(){}},{key:"destroy",value:function(){this.shouldBeDestroyed=!0}}])&&y(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();const b=p;function m(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,o,s,a=[],l=!0,u=!1;try{if(o=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;l=!1}else for(;!(l=(n=o.call(r)).done)&&(a.push(n.value),a.length!==t);l=!0);}catch(e){u=!0,i=e}finally{try{if(!l&&null!=r.return&&(s=r.return(),Object(s)!==s))return}finally{if(u)throw i}}return a}}(e,t)||function(e,t){if(e){if("string"==typeof e)return g(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?g(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function g(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var A=function(e){var t=m(e,2),r=t[0],n=t[1];return r>=0&&n>=0&&r<12&&n<12};function w(e){return w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},w(e)}function P(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,o,s,a=[],l=!0,u=!1;try{if(o=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;l=!1}else for(;!(l=(n=o.call(r)).done)&&(a.push(n.value),a.length!==t);l=!0);}catch(e){u=!0,i=e}finally{try{if(!l&&null!=r.return&&(s=r.return(),Object(s)!==s))return}finally{if(u)throw i}}return a}}(e,t)||function(e,t){if(e){if("string"==typeof e)return S(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?S(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function S(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function k(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,L(n.key),n)}}function j(e,t,r){return(t=L(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function L(e){var t=function(e,t){if("object"!=w(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!=w(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==w(t)?t:String(t)}var O=[[0,-1],[1,0],[0,1],[-1,0]],C=function(){function e(t,r,n,i,o,s){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),j(this,"shouldResetOnResume",!0),j(this,"renderingPausePromise",null),j(this,"score",0),j(this,"foodList",[]),j(this,"player",void 0),j(this,"ctx",void 0),j(this,"ch",void 0),j(this,"cw",void 0),j(this,"getGridPosInPx",void 0),j(this,"gridCellUnitPx",void 0),j(this,"totalCells",144),j(this,"field",null),this.ctx=t,this.forceUpdate=s,this.getGridPosInPx=o,this.gridCellUnitPx=i,this.cw=r,this.ch=n}var t,r;return t=e,r=[{key:"setField",value:function(e,t){var r=P(e,2),n=r[0],i=r[1];this.field[n][i]=t}},{key:"schedulePause",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){};this.renderingPausePromise=new Promise((function(r){e._pausePromiseResolve=function(){e.renderingPausePromise=null,e._pausePromiseResolve=null,t(),r()}}))}},{key:"resume",value:function(){this._pausePromiseResolve&&(this._pausePromiseResolve(),this.shouldResetOnResume&&(this.shouldResetOnResume=!1,this.reset(O[1])))}},{key:"drawPauseMessage",value:function(e){var t=new b(this.cw,this.ch,this.gridCellUnitPx,e);this.loadObject(t),this.schedulePause((function(){return t.destroy()}))}},{key:"showStartScreen",value:function(){this.drawPauseMessage("<Space> to start")}},{key:"showPauseScreen",value:function(){this.drawPauseMessage("<Space> to resume")}},{key:"showFinalScore",value:function(){this.shouldResetOnResume=!0,this.drawPauseMessage("Score: ".concat(this.score,"\n<Space> to restart"))}},{key:"spawnFood",value:function(){var e=this.totalCells-this.player.snakeLength()-this.foodList.length;if(e<1)this.showFinalScore();else for(var t=Math.floor(Math.random()*e),r=0;r<12;r++)for(var n=0;n<12;n++){if(!t){this.setField([r,n],2);var i=new h([r,n],this.getGridPosInPx([r,n]),this.gridCellUnitPx);return this.foodList.push(i),void this.loadObject(i)}0===this.field[r][n]&&t--}}},{key:"eatCell",value:function(e,t){var r=P(e,2),n=r[0],i=r[1];if(!A([n,i]))return this.showFinalScore(),!1;switch(this.setField(t,0),this.field[n][i]){case 1:return this.showFinalScore(),!1;case 2:var o=this.foodList.findIndex((function(e){return function(e,t){var r=m(e,2),n=r[0],i=r[1],o=m(t,2),s=o[0],a=o[1];return n===s&&i===a}(e.gridPos,[n,i])}));return this.score+=100,o>=0&&(this.foodList.at(o).destroy(),this.foodList.splice(o,1)),this.spawnFood(),!0;default:return!1}}},{key:"handleDirection",value:function(e){if(e){var t,r,n,i,o,s=(t=e,n=(r=m(this.player.dir,2))[0],i=r[1],[n+(o=m(t,2))[0],i+o[1]]);0===s[0]&&0===s[1]||(this.player.dir=e,this.forceUpdate())}}},{key:"handleKeyPress",value:function(e){if(!this.renderingPausePromise)switch(e.code){case"ArrowUp":return void this.handleDirection(O[0]);case"ArrowRight":return void this.handleDirection(O[1]);case"ArrowDown":return void this.handleDirection(O[2]);case"ArrowLeft":return void this.handleDirection(O[3]);case"Space":return void this.showPauseScreen();default:return}"Space"===e.code&&this.resume()}},{key:"reset",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[0,0];this.field=new Array(12).fill(0).map((function(){return new Array(12).fill(0)})),this.player&&this.player.destroy(),this.foodList.forEach((function(e){return e.destroy()})),this.score=0,this.foodList=[],this.player=new o(this.gridCellUnitPx,this.getGridPosInPx);var r=[[2,0],[1,0],[0,0]];this.player.init(this.eatCell.bind(this),r,t),r.forEach((function(t){return e.setField(t,1)})),this.spawnFood(),this.loadObject(this.player)}},{key:"run",value:function(e){var t=this;this.loadObject=e,this.shouldResetOnResume=!0,this.showStartScreen(),window.addEventListener("keydown",(function(e){t.handleKeyPress(e)}))}},{key:"stop",value:function(){this.shouldStop=!0}},{key:"update",value:function(e){var t=this;this.renderingPausePromise||!this.player||0!=e&&30!=e||(!this.player.shouldBeDestroyed&&A(this.player.headPos())?(this.foodList.forEach((function(e){return t.setField(e.gridPos,2)})),this.setField(this.player.headPos(),1),this.setField(this.player.tailPos(),1)):this.showFinalScore())}}],r&&k(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();const I=C;function D(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var E,R,B,F,x,U,T,M,G,Q,H,z,J,K=(E=document.getElementById("mainCanvas"),R=-1,B=[],F=E.getContext("2d"),x=E.getBoundingClientRect(),U=x.width,T=x.height,M=0*U/12,Q=new I(F,U,T,G=1*U/12,(function(e){var t,r,n=(r=2,function(e){if(Array.isArray(e))return e}(t=e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,o,s,a=[],l=!0,u=!1;try{if(o=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;l=!1}else for(;!(l=(n=o.call(r)).done)&&(a.push(n.value),a.length!==t);l=!0);}catch(e){u=!0,i=e}finally{try{if(!l&&null!=r.return&&(s=r.return(),Object(s)!==s))return}finally{if(u)throw i}}return a}}(t,r)||function(e,t){if(e){if("string"==typeof e)return D(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?D(e,t):void 0}}(t,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),i=n[0],o=n[1];return[M+i*(M+G),M+o*(M+G)]}),(function(){R=-1})),H=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"purple";F.fillStyle=e,F.fillRect(0,0,U,T)},z=function(e){B.push(e)},J=function e(){R=((R=R+5&63)-4>>31&4|R&~(R-4>>31))-4,H(),(B=B.filter((function(e){return!e.shouldBeDestroyed}))).forEach((function(e){return e.update&&e.update(R)})),Q.update(R),(B=B.filter((function(e){return!e.shouldBeDestroyed}))).forEach((function(e){return e.draw(F)})),Q.renderingPausePromise?Q.renderingPausePromise.then((function(){e()})):requestAnimationFrame(e)},{run:function(){H("#000"),Q.run(z),requestAnimationFrame(J)}});document.getElementById("mainCanvas").focus(),K.run()})();